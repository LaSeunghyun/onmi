# PRD: 주식 신호·공시 알림 (최종 확정안)

## 1. 요약
- 종목별 `corp_code(8자리)` 기준으로 시세·지표·공시를 결합해 **매수/매도/홀딩** 판단을 제공하고, 조건 충족 시 **푸시 알림**을 발송한다.
- 자동매매는 제외하며, 앱 중심·최대 10종목·퍼센트 규칙 사용자 설정·로그 전량 보관을 적용한다.

## 2. 리플래시 정책 (확정)

### 시세 API 한도 (금융위원회_주식시세정보)
- **일일 트래픽**: 10,000건/일 (활용신청 상세기능정보 기준)
- **초당 트랜잭션**: 30 TPS
- **데이터 갱신주기**: 일 1회 (공식 문서)

### 10종목 기준 호출량
- 1회 리플래시 = 종목당 1호출 → 10호출
- 이론 최대 리플래시/일: 10,000 / 10 = **1,000회**
- 안전 마진 70% 사용 시: **700회/일** → 주기 = 86400 / 700 ≈ **123초**

### 확정 정책
| 항목 | 값 |
|------|-----|
| 기본 리플래시 주기 | 60초 (사용자 조정 가능: 60 / 120 / 300초) |
| 일일 한도 | 10,000 (시세 API) |
| 한도 70% 도달 | 주기 자동 120초로 확대 |
| 한도 85% 도달 | 주기 자동 300초로 확대 |
| 중복 데이터 감지 | 기준일자·종가 동일 시 다음 주기까지 스킵 가능 |

## 3. 범위
- **In**: 감시종목 CRUD(최대 10), 즐겨찾기·순서 조정, 시세 수집(getStockPriceInfo), MACD/25일 EMA/기울기/거래량(20일 평균 1.5배), 매수/매도/홀딩 규칙, 데드크로스·퍼센트(손절/익절) 사용자 설정, DART 공시 수집·감성 라벨·요약, 푸시 발송, API 키 사후 입력, 로그 전량 보관.
- **Out**: 자동매매, 투자자문, 웹 우선 UI.

## 4. 규칙 스펙 (Step 1 확정)
- **매수**: MACD 하락→상승 전환 AND 25일 EMA 기울기 ≥ 임계치 AND (옵션) 거래량 ≥ 20일 평균×1.5.
- **매도**: MACD 데드크로스 OR 현재가 대비 손절% 도달 OR 익절% 도달.
- **홀딩**: 위 매수/매도 미충족.
- **퍼센트 규칙**: 사용자 설정(기본값 없음, 사용자 입력 필수).
- **거래량 조건**: 기본 20일 평균 대비 1.5배, 온/오프 가능.

## 5. 단계별 개발 경계
- Step 1: 규칙 스펙 확정 ✅ (본 문서)
- Step 2: 종목/즐겨찾기(10개 제한) — API 모델·라우터, 앱 리스트·순서
- Step 3: 시세 수집 — getStockPriceInfo 연동
- Step 4: 지표 계산·판단 엔진 — MACD/EMA/신호
- Step 5: 공시 수집·분류·요약 — DART 연동
- Step 6: 푸시 알림 — 조건 충족 시 발송·쿨다운
- Step 7: 한도 연동 리플래시 가드
- Step 8: 로그 전량 보관·QA
